### Idris ãã»ã‚“ã®ã

Yohei Oda

---

### whoami

- Scalaã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼ˆäºŒå¹´åŠï¼‰
- JVMã¨ã‹GCã¨ã‹å¥½ã
- Haskellã¯ã™ã”ã„Hæœ¬ã‚’ä¸€é€šã‚Šèª­ã‚“ã ãã‚‰ã„
- Coq??ğŸ˜‡

---

### What's idris?

- Haskellãƒ™ãƒ¼ã‚¹ã®é–¢æ•°å‹è¨€èª
  - æ–‡æ³•ã¯ã»ã¼Haskell
  - å®Ÿè£…ã‚‚Haskellãƒ¡ã‚¤ãƒ³
  - ä½¿ã„ã‚„ã™ã„BetterHaskellçš„ãªå´é¢
    - æ­£æ ¼è©•ä¾¡ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    - `:` ã¨ `::` ãŒé€†
    - ã¡ã‚‡ã£ã¨ä¾¿åˆ©ãªé–¢æ•°ãŒå¢—ãˆã¦ã‚‹ etc

---

### What's idris?

- è³‡æ–™ã‚’æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.1.1
  - æœ¬(â€»)ãŒå‡ºãŸã®ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³1ã‚’å‡ºã—ãŸ
    - ä»Šæ—¥ã®èª¬æ˜ã‚‚ã“ã®æœ¬ãŒãƒ™ãƒ¼ã‚¹
    - èˆˆå‘³ãŒã‚ã‚‹ã‹ãŸã¯ãœã²è²·ã£ã¦ã¿ã¦ãã ã•ã„
  - ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§ä½¿ãˆã‚‹ã¨ã‹ãã†ã„ã†è©±ã§ã¯ãªã„

â€» Type Driven Development with Idris

---

### What's idris?

- ä¾å­˜å‹ã‚’æ‰±ã†ã“ã¨ãŒã§ãã‚‹

---

### ä¾å­˜å‹

- å‹ã¨å€¤ãŒçµ„ã¿åˆã‚ã•ã£ãŸã¨ã¦ã‚‚å¼·ã„å‹
  - å‹ãŒå€¤ã«ä¾å­˜ã™ã‚‹
- `types are first class`
  - å¼•æ•°ã¨ã—ã¦æ¸¡ã—ãŸã‚Šè¨ˆç®—ã—ãŸã‚Šã§ãã‚‹
- å‹ã‚’ä½¿ã£ãŸå‘½é¡Œã®è¨¼æ˜ãŒã§ãã‚‹
  - Coq ã‚„ Agda ãªã©ãŒä»£è¡¨çš„
  - Idris ã¯è¨¼æ˜ã‚ˆã‚Šå‹å®‰å…¨ãªï¼ˆæ™®é€šã®ï¼‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è·¯ç·šï¼ˆã‚‰ã—ã„ï¼‰
  
---

### ä¾å­˜å‹ã®ä¾‹

- é•·ã•ã‚’å‹ã«æŒã¤ãƒªã‚¹ãƒˆ Vect å‹
  - `Vect n a`
    - n ã¯è¦ç´ ã®æ•°ã€ a ã¯è¦ç´ ã®å‹

---

### Vect ã®å‹ã¨ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

#### å‹

```haskell
Vect : Nat -> Type -> Type
```

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```haskell
Nil : Vect 0 elem
    Empty vector

(::) : (x : elem) -> (xs : Vect len elem) -> Vect (S len) elem
    A non-empty vector of length S len, consisting of a head element and the rest of the list, of length len.
    infixr 7
```

---

### Vect ã®åŸºæœ¬çš„ãªå‡¦ç†ã‚’æ›¸ã„ã¦ã¿ã¾ã™

---

### List ã® map

```haskell
my_list_map: (a->b) -> List a -> List b
my_list_map f [] = []
my_list_map f (x :: xs) = f x :: my_map f xs
```

---

### Vect ã® map

```haskell
my_vect_map: (a->b) -> Vect n a -> Vect n b
my_vect_map f [] = []
my_vect_map f (x :: xs) = f x :: my_vect_map f xs
```

- ã€Œmapé–¢æ•°ã‚’ä½¿ã£ã¦ã‚‚è¦ç´ ã®æ•°ã¯å¤‰ã‚ã‚‰ãªã„ã€ã“ã¨ãŒå‹ã§ä¿è¨¼ã•ã‚Œã¦ã„ã‚‹

---

### List ã® append

```haskell
my_list_append : List a -> List a -> List a
my_list_append [] ys = ys
my_list_append (x :: xs) ys = x :: my_list_append xs ys
```

---

### Vect ã® append

```haskell
my_vect_append : Vect n a -> Vect m a -> Vect (n + m) a
my_vect_append [] ys = ys
my_vect_append (x :: xs) ys = x :: my_vect_append xs ys
```

- å¼•æ•°ã®2ã¤ã®é•·ã•ã‚’åˆè¨ˆã—ãŸé•·ã•ã®VectãŒè¿”ã£ã¦ãã‚‹

---

### Vect ã® zip

```haskell
my_vect_zip : Vect n a -> Vect n b -> Vect n (a, b)
my_vect_zip [] ys = []
my_vect_zip (x :: xs) (y :: ys) = (x, y) :: my_vect_zip xs ys
```

- åŒã˜é•·ã•ã®2ã¤ã®Vectã«ã—ã‹ä½¿ã†ã“ã¨ãŒã§ããªã„
- è¤‡æ•°ã®å¼•æ•°ã‚’ã¨ã‚‹å ´åˆã§ã‚‚ã‚·ã‚°ãƒãƒãƒ£ã ã‘ã§é–¢ä¿‚æ€§ã‚’è¡¨ç¾ã§ãã‚‹

---

### é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã§é¢å€’ãªã“ã¨

- è‰²ã€…ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã®å…¥åŠ›ã«å¯¾å‡¦ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
  1. æ™®é€šã®å€¤
  1. ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹
  1. ã‚„ã£ã¦ã»ã—ããªã„ãŒå‹ã®éƒ½åˆä¸Šæ¸¡ã›ã¦ã—ã¾ã†å€¤
- æ›´ã«å…¥åŠ›å€¤ãŒè¤‡æ•°ã‚ã‚‹ã¨çµ„ã¿åˆã‚ã›ãŒçˆ†ç™ºã™ã‚‹

---

### é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã§é¢å€’ãªã“ã¨

- å‘¼ã³å‡ºã—å´ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä¿¡ç”¨ã§ããªã„
- æ˜ã‚‰ã‹ã«ãƒ€ãƒ¡ãã†ãªå€¤ãŒæ¸¡ã•ã‚ŒãŸæ™‚ã«ã©ã†ã™ã‚‹ã‹ï¼Ÿ
  - é–¢æ•°ã‚’å®Ÿè£…ã™ã‚‹äººã®é–¢å¿ƒäº‹ã§ã¯ãªã„
  - ã‚ã‘ã®ã‚ã‹ã‚‰ãªã„å€¤ã‚’å…¥ã‚Œã¦ãã‚‹æ–¹ãŒæ‚ªã„ğŸ˜¤

---

### ãƒªã‚¹ãƒˆã®è¦ç´ ã‚’æ·»å­—ã§å–ã‚Šå‡ºã™ index é–¢æ•° ã‚’ä½œã‚‹

```haskell
index: List a -> Integer -> a
```

- ãƒã‚¤ãƒŠã‚¹ã®æ•°å€¤ãŒæ¥ãŸæ™‚ã©ã†ã™ã‚‹ï¼Ÿ
- ãƒªã‚¹ãƒˆã®ã‚µã‚¤ã‚ºã‚ˆã‚Šå¤§ããªå€¤ãŒããŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ

---

### å‹ã‚’ã¡ã‚‡ã£ã¨å¼·ãã™ã‚‹

```haskell
index: List a -> Nat -> a
```

- æ·»å­—ã‚’ `Nat` (è‡ªç„¶æ•°ã‚’è¡¨ã™å‹) ã§æ¸¡ã™ã‚ˆã†ã«å¤‰æ›´
  - ãƒã‚¤ãƒŠã‚¹ã®æ•°ã‚’æ¸¡ã™ã“ã¨ã¯ã§ããªã„
- ãƒªã‚¹ãƒˆã®ã‚µã‚¤ã‚ºã‚ˆã‚Šå¤§ããªå€¤ãŒããŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ

---

### ä¾å­˜å‹ã‚’ä½¿ã†

```haskell
index: Vect n a -> Fin n -> a
```

- `List a` ã‚’ `Vect n a` ã«å¤‰æ›´
- æ·»å­—ã‚’ `Fin n` (n ã‚ˆã‚Šå°ã•ã„è‡ªç„¶æ•°ã‚’è¡¨ã™å‹) ã§æ¸¡ã™
- è¦ç´ ã‚’å¿…ãšå–ã‚Šå‡ºã›ã‚‹ã“ã¨ã‚’å‹ã§ä¿è¨¼ã§ãã‚‹

---

### é–¢æ•°ã«ä¾å­˜å‹ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ

- ã‚ã‚‰ã‹ã˜ã‚é–¢æ•°ãŒæœŸå¾…ã™ã‚‹å€¤ã‚’å‹ã¨ã—ã¦è¡¨ç¾ã§ãã‚‹
  - è¤‡æ•°ã®å€¤ã®çµ„ã¿åˆã‚ã›ã‚‚å‹ã®åˆ¶ç´„å¯¾è±¡ã«ã§ãã‚‹
  - æœŸå¾…ã™ã‚‹å€¤ãŒæ¸¡ã•ã‚ŒãŸæ™‚ã®æŒ¯ã‚‹èˆã„ã®ãƒ†ã‚¹ãƒˆã«æ³¨åŠ›ã§ãã‚‹

---

### é–¢æ•°ã«ä¾å­˜å‹ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ

- å¼•æ•°ã«æ¸¡ã™å‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—å´ã«å¼·åˆ¶ã§ãã‚‹
- å‘¼ã³å‡ºã—å´ã‹ã‚‰è¦‹ã‚‹ã¨â€¦
  - é–¢æ•°ãŒæ±‚ã‚ã‚‹å€¤ã‚’ã‚·ã‚°ãƒãƒãƒ£ã ã‘ã§åˆ¤æ–­ã§ãã‚‹
  - å¿…è¦ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ˜ç¢º

---

ã„ã„æ„Ÿã˜ğŸ˜Š

---

### ã“ã“ã§å•é¡Œ

1. `zip: Vect n a -> Vect n b -> Vect n (a, b)` ãŒã‚ã‚‹
1. `Vect n String` ã¨ `Vect m Int` ãŒã‚ã‚‹
1. `n==m` ã¯ `True` ã§ã‚ã‚‹
1. `zip` ã‚’å‘¼ã¶ã“ã¨ã¯ã§ãã‚‹ï¼Ÿ

---

- ã§ããªã„ğŸ˜­
- `==` ã®æŒ¯ã‚‹èˆã„ã¯å‹ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„
  - å‹ãƒã‚§ãƒƒã‚«ãƒ¼ã¯ã€Œ`n==m` ã ã‹ã‚‰ `n ã¨ m ã¯åŒã˜` ã€ã¨åˆ¤å®šã§ããªã„
- å‹ãƒã‚§ãƒƒã‚«ãƒ¼ã«ã‚‚ã‚ã‹ã‚‹ã‚ˆã†ã«æ›¸ã„ã¦ã¿ã‚‹
 Â - ï¼ˆå®Ÿéš›ã¯çµ„ã¿è¾¼ã¿ã®é–¢æ•°ã§ã‚‚ã£ã¨æ¥½ã§ãã¾ã™ï¼‰

---

#### Natã®å€¤ãŒåŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™å‹

```haskell
data EqNat : (num1 : Nat) -> (num2 : Nat) -> Type where
     Same : (num : Nat) -> EqNat num num
```

ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‹ã‚‰ä»¥ä¸‹ã®ã“ã¨ãŒåˆ¤æ–­å¯èƒ½

- `EqNat a b` å‹ã®å€¤ãŒå­˜åœ¨ã—ã¦ã„ã‚Œã°ã€a ã¨ b ã¯åŒã˜å€¤ã§ã‚ã‚‹

---

#### 2ã¤ã®åŒã˜å€¤ã«ãã‚Œãã‚Œ1ã‚’è¶³ã—ã¦ã‚‚åŒã˜å€¤ã«ãªã‚‹

```hakell
sameS : (k: Nat) -> (j: Nat) -> (eq : EqNat k j) -> EqNat (S k) (S j)
sameS j j (Same j) = Same(S j)
```

`EqNat k j` ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã®ã§ k ã¨ j ãŒåŒã˜å ´åˆã ã‘å®Ÿè£…ã‚’æ›¸ã‘ã°è‰¯ã„

---

#### 2ã¤ã®å€¤ãŒåŒã˜ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹é–¢æ•°

```haskell
checkEqNat : (num1 : Nat) -> (num2 : Nat) -> Maybe (EqNat num1 num2)
checkEqNat Z Z = Just (Same 0)
checkEqNat Z (S k) = Nothing
checkEqNat (S k) Z = Nothing
checkEqNat (S k) (S j) = case checkEqNat k j of
                              Nothing => Nothing
                              (Just eq) => Just (sameS _ _ eq)
```

---

#### å‹ã‚’å¤‰æ›ã™ã‚‹é–¢æ•°

```haskell
exactLength : (len : Nat) -> (input : Vect m a) -> Maybe (Vect len a)
exactLength {m} len input = case checkEqNat m len of
                                 Nothing => Nothing
                                 Just (Same len) => Just input

```

- `vect_m` ãŒ `Vect m a`
- `n` ã¨ `m` ãŒç­‰ã—ã„

å ´åˆã«

`extractLength n vect_m` ã¨ã™ã‚‹ã¨ã€ `Just Vect n a` ãŒè¿”ã‚‹

(= Idris ãŒå‹ãƒ¬ãƒ™ãƒ«ã§ vect_m ãŒ `Just Vect n a` å‹ã ã¨åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹)

---
